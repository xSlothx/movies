SET ANSI_NULLS ON
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE C_SP_Order_Status @w_id		INT, @d_id		TINYINT, @c_id		INT, @c_last		CHAR(16) as declare 	@c_balance		NUMERIC(12,2), 	@c_first		CHAR(16), 	@c_middle		CHAR(2), 	@o_id			INT, 	@o_entry_d		DATETIME, 	@o_carrier_id	SMALLINT, 	@val			SMALLINT, 	@cnt			SMALLINT begin transaction orderstatus 	if (@c_id = 0) 	begin 		select @cnt = count(*) 		from C_Customer with (repeatableread) 		where c_last = @c_last 		and c_w_id = @w_id 		and c_d_id = @d_id 		select @val = (@cnt + 1)/2 		set rowcount @val 		select @c_id = c_id, 			@c_balance = c_balance, 			@c_first = c_first, 			@c_last = c_last, 			@c_middle = c_middle 		from C_Customer with (repeatableread) 		where c_last = @c_last 		and c_w_id = @w_id 		and c_d_id = @d_id 		order by c_w_id, c_d_id, c_last, c_first 		set rowcount 0 	end 	else 	begin 		select @c_balance = c_balance, 			@c_first = c_first, 			@c_middle = c_middle, 			@c_last = c_last 		from C_Customer with (repeatableread) 		where c_id = @c_id 		and c_d_id = @d_id 		and c_w_id = @w_id 		select @cnt = @@rowcount 	end 	if (@cnt = 0) 	begin 		raiserror('Customer not found',18,1)  		goto custnotfound 	end 	select @o_id = o_id, 		@o_entry_d = o_entry_d, 		@o_carrier_id = o_carrier_id 	from C_Order (serializable) 	where o_c_id = @c_id 	and o_d_id = @d_id 	and o_w_id = @w_id 	select ol_supply_w_id, 		ol_i_id, 		ol_quantity, 		ol_amount, 		ol_delivery_d 	from C_Order_Line with (repeatableread) 	where ol_o_id = @o_id 	and ol_d_id = @d_id 	and ol_w_id = @w_id custnotfound: commit transaction orderstatus select @c_id, 	@c_last, 	@c_first, 	@c_middle, 	@o_entry_d, 	@o_carrier_id, 	@c_balance, 	@o_id 
GO
